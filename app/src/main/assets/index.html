<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orit Live - Clappr</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://i.ibb.co/WtzxpGF/1000033024.png">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #000000; color: #fff; height: 100vh; overflow: hidden; }

        .container { display: flex; height: 100vh; width: 100vw; flex-direction: column; }

        /* Player Area */
        #player-container { width: 100%; background: #000; position: relative; display: flex; align-items: center; justify-content: center; height: 40vh; transition: height 0.3s ease; }
        #player-wrapper { width: 100%; height: 100%; }

        /* Channel Section */
        .channel-section {
            background-image: url('https://raw.githubusercontent.com/cracker2161/syncing_file/refs/heads/main/logo/bitt%20ka%20naam.jpeg');
            background-size: cover; background-position: center;
            flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }
        .channel-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 1; }

        .search-bar, .channel-list, .footer { position: relative; z-index: 2; }

        /* UI Elements */
        .search-bar { padding: 10px; background: rgba(0, 0, 0, 0.8); box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .search-bar input { width: 100%; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 6px; outline: none; background: rgba(255, 255, 255, 0.1); color: #ffffff; font-size: 16px; }
        .channel-list { flex: 1; overflow-y: auto; scrollbar-width: thin; }
        .channel-item { display: flex; align-items: center; padding: 12px 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; background: rgba(0, 0, 0, 0.2); }
        .channel-item:hover, .channel-item.active { background: rgba(255, 255, 255, 0.15); }
        .channel-item img { width: 45px; height: 45px; margin-right: 15px; border-radius: 6px; object-fit: contain; background: #000; }
        .channel-item span { color: #fff; font-size: 15px; font-weight: 500; }
        .footer { padding: 10px; text-align: center; background: rgba(0, 0, 0, 0.9); font-size: 12px; }
        .footer a { color: #ccc; text-decoration: none; }

        /* ---------- PIP MODE STYLES (‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡¶ø‡¶ï ‡¶ï‡ßã‡¶°) ---------- */
        /* ‡¶Ø‡¶ñ‡¶® ‡¶¨‡¶°‡¶ø‡¶§‡ßá 'pip-active' ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶§‡¶ñ‡¶® ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá */
        body.pip-active .channel-section { display: none !important; }
        body.pip-active .container { height: 100vh; width: 100vw; }
        body.pip-active #player-container { height: 100vh !important; width: 100vw !important; }
        /* ---------------------------------------------------- */

        /* Desktop View */
        @media (min-width: 768px) {
            .container { flex-direction: row; }
            #player-container { height: 100vh; width: 75%; }
            .channel-section { height: 100vh; width: 25%; min-width: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="player-container">
            <div id="player-wrapper"></div>
        </div>

        <div class="channel-section">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search TV Channels..." onkeyup="filterChannels()">
            </div>
            <div class="channel-list" id="channel-list">
                <div style="padding: 20px; text-align: center; color: #aaa;">Loading channels...</div>
            </div>
            <div class="footer">
                <a href="updates.html">Developed by Oriby Team ‚Äì Brought to life by Sultan üî•</a>
            </div>
        </div>
    </div>

    <script>
        let playerInstance = null;
        const M3U_URL = 'https://m3u.ch/pl/b3499faa747f2cd4597756dbb5ac2336_e78e8c1a1cebb153599e2d938ea41a50.m3u';

        // --- PIP Control Function (Called from Java) ---
        function togglePiPMode(enable) {
            if (enable) {
                document.body.classList.add('pip-active');
                if(playerInstance) playerInstance.resize({height: '100%', width: '100%'});
            } else {
                document.body.classList.remove('pip-active');
                if(playerInstance) playerInstance.resize({height: '100%', width: '100%'});
            }
        }
        // ----------------------------------------------

        window.onload = () => { loadChannels(); };

        function initPlayer(url) {
            if (playerInstance) playerInstance.destroy();
            playerInstance = new Clappr.Player({
                source: url,
                parentId: '#player-wrapper',
                width: '100%', height: '100%',
                autoPlay: true,
                poster: 'https://raw.githubusercontent.com/sultanarabi161/mxonliveo/refs/heads/main/app/src/main/res/drawable/app_logo.png',
                playback: { playInline: true, recycleVideo: true }
            });
        }

        async function loadChannels() {
            try {
                const response = await fetch(M3U_URL);
                if (!response.ok) throw new Error('Network response');
                const playlist = await response.text();
                parseM3U(playlist);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('channel-list').innerHTML = '<div style="padding: 20px; text-align: center; color: #ff6b6b;">Failed to load list.</div>';
            }
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            const channels = [];
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.startsWith('#EXTINF')) {
                    const url = (lines[i + 1] || '').trim();
                    if (url && !url.startsWith('#')) {
                        const logoMatch = line.match(/tvg-logo="([^"]*)"/);
                        const logo = logoMatch ? logoMatch[1] : '';
                        const infoParts = line.split(',');
                        let name = infoParts.length > 1 ? infoParts.slice(1).join(',').trim() : 'Unknown';
                        channels.push({ name, url, logo });
                    }
                }
            }
            renderChannels(channels);
        }

        function renderChannels(channels) {
            const list = document.getElementById('channel-list');
            list.innerHTML = '';
            if (channels.length === 0) { list.innerHTML = '<div style="padding:20px; text-align:center;">No channels found.</div>'; return; }

            channels.forEach((channel, index) => {
                const item = document.createElement('div');
                item.className = 'channel-item';
                const logoSrc = channel.logo || 'https://via.placeholder.com/45?text=TV';
                item.innerHTML = `<img src="${logoSrc}" onerror="this.src='https://via.placeholder.com/45?text=TV'"><span>${channel.name}</span>`;
                item.onclick = function() {
                    document.querySelectorAll('.channel-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    initPlayer(channel.url);
                };
                list.appendChild(item);
                if (index === 0) { item.classList.add('active'); initPlayer(channel.url); }
            });
        }

        function filterChannels() {
            const input = document.getElementById('search-input').value.toLowerCase();
            document.querySelectorAll('.channel-item').forEach(item => {
                const name = item.querySelector('span').textContent.toLowerCase();
                item.style.display = name.includes(input) ? 'flex' : 'none';
            });
        }
    </script>
</body>
</html>
